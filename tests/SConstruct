import os
import subprocess
os.makedirs('../Catch2/.build', exist_ok=True)
os.chdir('../Catch2/.build')
subprocess.run(['cmake', '..', '-DCMAKE_CXX_FLAGS=-D_GLIBCXX_USE_CXX11_ABI=0'])
subprocess.run(['make'])
os.chdir('../..')
os.makedirs('build', exist_ok=True)
env = Environment(CXX='g++')
env.Append(CXXFLAGS=['-std=c++17', '-Wall', '-Wextra', '-pedantic', '-Werror', '-w',"-D_GLIBCXX_USE_CXX11_ABI=0"])
env.Append(CPPPATH=["../Catch2/.build/generated-includes", "../Catch2/src", "../core/include", '../ArtifficalInteligenceModels/libtorch/include', '../ArtifficalInteligenceModels/libtorch/include/torch/csrc/api/include', '../ArtifficalInteligenceModels/include/'])
env.Append(LIBPATH=["../Catch2/.build/src",'../ArtifficalInteligenceModels/libtorch/lib','../ArtifficalInteligenceModels/lib'])
lib = SConscript('../core/SConstruct', exports='env')
env.Append(LIBS=["Catch2Main", "Catch2", 'torch_cpu', 'torch', 'c10', lib,  'ai'])
test_sources = Glob('*.cpp')
target = env.Program(target = 'build/tests', source = test_sources)
Depends(target, lib)
Default(target)
Return('target')