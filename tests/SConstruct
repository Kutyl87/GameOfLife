import os
import subprocess
os.makedirs('../Catch2/.build', exist_ok=True)
os.chdir('../Catch2/.build')
subprocess.run(['cmake', '..'])
subprocess.run(['make'])
os.chdir('../..')
os.makedirs('build', exist_ok=True)
env = DefaultEnvironment(CXX='g++')
env.Append(CXXFLAGS=['-std=c++17', '-Wall', '-Wextra', '-pedantic', '-Werror'])
env.Append(CPPPATH=["../Catch2/.build/generated-includes", "../Catch2/src", "../core/include"])
env.Append(LIBPATH=["../Catch2/.build/src"])
lib = SConscript('../core/SConstruct', exports='env')
env.Append(LIBS=["Catch2Main", "Catch2", lib])
test_sources = Glob('*.cpp')
target = env.Program(target = 'build/tests', source = test_sources)
Depends(target, lib)
Default(target)
Return('target')